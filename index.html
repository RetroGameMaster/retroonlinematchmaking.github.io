<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RetroOnlineMatchmaking</title>
<style>
/* --- Base Styling --- */
body, html {
  margin:0; padding:0; font-family:"Orbitron", Arial, sans-serif;
  background:#000; color:#fff; overflow-x:hidden; cursor:none;
}

/* --- Splash Screen --- */
#splash {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center;
  z-index:3000; color:#0ff; transition: opacity 0.45s ease, transform 0.45s ease;
}
#splash.fade {
  opacity:0; transform:scale(1.02); pointer-events:none;
}
#splash h1 {
  font-size:clamp(28px,6vw,48px); animation:flicker 1s infinite; margin:0; text-align:center;
  text-shadow: 0 0 12px rgba(0,255,255,0.12);
}
#splash p {
  font-size:clamp(12px,2.4vw,18px); margin:0.5rem 0; animation:flicker 1.5s infinite; text-align:center;
  color: #ff33cc;
}
@keyframes flicker { 0%,100%{opacity:1} 50%{opacity:0.6} }

/* --- Progress --- */
#progressContainer {
  width:70%; max-width:560px; height:12px; background:rgba(0,255,255,0.04); border:2px solid rgba(0,255,255,0.08);
  border-radius:10px; margin-top:18px; overflow:hidden; display:block;
  box-shadow: inset 0 0 18px rgba(0,255,255,0.02);
}
#progressBar { width:0%; height:100%; background:linear-gradient(90deg,#00e0ff,#ff33cc); transition:width 0.12s linear; }

/* --- Starfield container fallback --- */
.stars { position:fixed; width:100%; height:100%; background:transparent; z-index:0; overflow:hidden; pointer-events:none; }

/* --- CRT & overlays --- */
.crt-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  pointer-events:none;
  background-image: repeating-linear-gradient(to bottom, rgba(255,255,255,0.03) 0, rgba(255,255,255,0.03) 1px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 3px);
  mix-blend-mode: overlay;
  opacity:0.12; z-index:2000;
}

/* --- Header / layout --- */
header{
  position:relative; z-index:20; padding:clamp(12px,3vw,28px);
  max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding-left:4vw; padding-right:4vw;
}
.brand { display:flex; gap:12px; align-items:center }
.brand .logo { width:48px; height:48px; border-radius:8px; background:linear-gradient(135deg,#00e0ff,#ff33cc);
  display:flex; align-items:center; justify-content:center; font-weight:700; color:#010101; font-size:18px;
  box-shadow:0 0 18px rgba(0,224,255,0.12);
}
.brand h1{ margin:0; font-size:clamp(16px,2.6vw,22px); color:#0ff; text-shadow:0 0 12px rgba(0,224,255,0.12); }
.brand p{ margin:0; font-size:12px; color:#bfeefc; opacity:0.9; }

/* Buttons */
.button {
  display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:10px;
  background:linear-gradient(180deg,#00d7ff,#00a8bf); color:#001; font-weight:700; border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 6px 20px rgba(0,224,255,0.06);
  text-decoration:none; cursor:pointer; user-select:none;
}
.button.muted{ background:linear-gradient(180deg,#ff33cc,#cc0099); color:#fff; }

/* --- Main Content --- */
#mainContent { display:none; min-height:100vh; position:relative; z-index:10; padding-bottom:4rem; }

/* --- Section top caption --- */
.platform-caption{
  text-align:center; color:#00ffff; font-weight:800; margin:1.2rem 0; font-size:1rem; text-shadow:0 0 8px rgba(0,255,255,0.08);
}

/* --- Collapsible --- */
.collapsible {
  background: rgba(0,0,0,0.6);
  color:#0ff;
  cursor:pointer;
  padding: 1rem;
  width: 90%;
  max-width:1100px;
  border: 2px solid #0ff;
  margin: 1rem auto;
  text-align:left;
  font-weight:800;
  border-radius:10px;
  position:relative;
  transition:0.25s;
}
.collapsible::after{
  content: '\25B6';
  font-size:1.1rem;
  position:absolute; right:20px; top:50%; transform:translateY(-50%);
  transition:0.25s;
}
.collapsible.active::after{ transform:translateY(-50%) rotate(90deg); }
.content { max-height:0; overflow:hidden; transition:max-height .35s ease; padding:0 1rem 0 1rem; }

/* --- Cards --- */
.card {
  background: rgba(0,0,0,0.6); border:1px solid rgba(0,224,255,0.06); border-radius:12px;
  margin:0.6rem auto; padding:12px; text-align:left; max-width:1100px;
  box-shadow:0 12px 30px rgba(0,0,0,0.6), 0 0 10px rgba(0,224,255,0.02);
}
.card h3 { color:#ff33cc; margin:0 0 6px 0; font-size:1.05rem; }
.card p { color:#cfeff6; margin:0.2rem 0; font-size:.95rem; }
.card a { color:#00e0ff; text-decoration:underline; font-weight:700; }

/* --- Submit section --- */
#submitMethodSection{
  margin:2rem auto; padding:18px; max-width:760px; border-radius:12px;
  background:linear-gradient(180deg, rgba(0,255,255,0.02), rgba(0,0,0,0.18));
  border:1px solid rgba(0,255,255,0.06);
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  text-align:center;
}
#submitMethodSection h2{ margin:0 0 8px 0; color:#00ffff; font-size:1.3rem; text-shadow:0 0 8px rgba(0,255,255,0.08); }
#submitMethodSection p{ margin:0 0 12px 0; color:#cfeff6; }

/* --- Modal --- */
.modal {
  display:none;
  position:fixed; left:0; top:0; width:100%; height:100%; z-index:4000;
  background:rgba(0,0,0,0.95); justify-content:center; align-items:center; padding:1rem;
}
.modal iframe{ width:90%; max-width:720px; height:85vh; border:none; border-radius:12px; box-shadow:0 0 25px rgba(0,255,255,0.08); }
.close-btn{ position:absolute; top:14px; right:18px; font-size:28px; color:#0ff; cursor:pointer }

/* --- Footer --- */
footer.site-footer { text-align:center; padding:18px 4vw; color:#a8dfe8; font-size:13px; border-top:1px solid rgba(0,224,255,0.04); margin-top:2.2rem }

/* --- Cursor (fixed for correct tracking) --- */
#customCursor{
  position:fixed; width:40px; height:40px; pointer-events:none; z-index:5000; transform:translate(-50%,-50%);
  filter: drop-shadow(0 6px 18px rgba(0,224,255,0.08));
}

/* --- Canvas BG --- */
canvas#retroCanvas{ position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; }

/* --- Responsive tweaks --- */
@media (max-width:820px){
  header{ padding:14px; align-items:flex-start; gap:10px; }
  .brand h1{ font-size:16px }
  #customCursor{ width:28px; height:28px }
  .collapsible{ width:94%; }
  #progressContainer{ width:86%; }
}
</style>
</head>
<body>
  <!-- Splash -->
  <div id="splash" role="dialog" aria-modal="true" aria-label="Boot splash">
    <div style="text-align:center;">
      <div style="display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:10px;">
        <div style="width:54px; height:54px; border-radius:10px; background:linear-gradient(135deg,#00e0ff,#ff33cc); box-shadow:0 0 24px rgba(0,224,255,0.12); display:flex; align-items:center; justify-content:center; font-weight:800; color:#010101;">ROM</div>
      </div>
      <h1 id="splashTitle">SYSTEM BOOTING...</h1>
      <p id="bootText">RetroOnlineMatchmaking â€” Initializing v1.0</p>
      <div id="progressContainer" aria-hidden="true"><div id="progressBar"></div></div>
    </div>
  </div>

  <!-- Decorative backgrounds -->
  <div class="stars" aria-hidden="true"></div>
  <canvas id="retroCanvas" aria-hidden="true"></canvas>
  <div class="crt-overlay" aria-hidden="true"></div>

  <!-- Main content -->
  <main id="mainContent" style="display:none;">
    <header class="site-header">
      <div class="brand">
        <div class="logo" aria-hidden="true">ROM</div>
        <div>
          <h1>RetroOnlineMatchmaking</h1>
          <p>Play classic games online again</p>
        </div>
      </div>

      <nav class="site-nav" aria-label="primary" style="display:flex; gap:8px; align-items:center;">
        <a class="button" href="https://discord.com/invite/jcRqpmMZdZ" target="_blank" rel="noopener">Join Discord</a>
        <a class="button" href="https://youtube.com/@retroonlinematchmaking?si=JASKyZdqxTyAenLb" target="_blank" rel="noopener">YouTube</a>
        <a class="button" id="openSubmitBtn">Submit Method</a>
        <a class="button" href="https://retroonlinematchmaking.flarum.cloud/" target="_blank" rel="noopener">Forum</a>
        <a class="button" id="musicButton" title="Toggle music (off by default)">ðŸ”Š Music</a>
      </nav>
    </header>

    <div style="max-width:1100px; margin:1.2rem auto; padding:0 4vw;">
      <div class="platform-caption">Find your Player 2 â€” choose a platform</div>

       <!-- PSP -->
<button class="collapsible" type="button">PSP Connections</button>
<div class="content" aria-hidden="true">

  <div class="card">
    <h3>EA Nation Hub â€” PSP</h3>
    <p>Unoffical hub to restore EA PSP multiplayer.</p>
    <p><a href="https://discord.com/invite/fwrQHHxrQQ" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://mohh-revival.pages.dev/#setup" target="_blank" rel="noopener">Setup Guide</a></p>
  </div>

  <div class="card">
    <h3>Madness Gaming Network</h3>
    <p><a href="https://discord.gg/madness-gaming-network-718348931133603841" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://discord.com/channels/1273100568117641269/1276580987643629578/1294667200434802750" target="_blank" rel="noopener">Guide</a></p>
  </div>

  <div class="card">
    <h3>Zero Tier</h3>
    <p><a href="https://my.zerotier.com/" target="_blank" rel="noopener">Website</a> â€¢ 
       <a href="https://www.youtube.com/watch?v=RdJTc4Kbaig" target="_blank" rel="noopener">Guide</a></p>
  </div>

  <div class="card">
    <h3>Socom.cc</h3>
    <p><a href="https://discord.gg/SmDJSyZQsb" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://www.socom.cc/status.xml" target="_blank" rel="noopener">Website</a> â€¢ 
       <a href="https://github.com/hrydgard/ppsspp/wiki/How-to-play-multiplayer-games-with-PPSSPP" target="_blank" rel="noopener">Guide</a></p>
  </div>

  <div class="card">
    <h3>OpenSpy</h3>
    <p><a href="https://discord.com/invite/sMaWdbt" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://beta.openspy.net/" target="_blank" rel="noopener">Website</a></p>
  </div>

  <div class="card">
    <h3>Xlink Kai</h3>
    <p><a href="https://www.teamxlink.co.uk/" target="_blank" rel="noopener">Website</a> â€¢ 
       <a href="https://discord.gg/team-xlink-official-521915206972997664" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://www.teamxlink.co.uk/wiki/PlayStation_Portable_XLink_Kai_Setup" target="_blank" rel="noopener">Real Hardware Guide</a></p>
    <p><a href="https://www.teamxlink.co.uk/wiki/JPCSP_PSP_Tutorial#:~:text=Now%2C%20as%20of%20Nov%2021st%202020%2C%20the%20PlayStation,and%20real%20PSP%20hardware%20for%20the%20first%20time!" target="_blank" rel="noopener">JPCSP PSP Tutorial</a></p>
  </div>

  <div class="card">
    <h3>Retroverse</h3>
    <p>IP: 10.42.0.1</p>
    <p><a href="https://retroverze.my.id/" target="_blank" rel="noopener">Website</a> â€¢ 
       <a href="https://discord.com/invite/dvspSEXQxa" target="_blank" rel="noopener">Discord</a></p>
  </div>

  <div class="card">
    <h3>AGRF</h3>
    <p><a href="https://agracingfoundation.org" target="_blank" rel="noopener">Website</a></p>
    <p>DNS: 147.135.213.57</p>
  </div>

</div>
      

       
      
      <!-- Vita -->
<button class="collapsible" type="button">Vita Connections</button>
<div class="content" aria-hidden="true">

  <div class="card">
    <h3>Vita3K â€” PS Vita</h3>
    <p>Ad-hoc revival via Vita3K with XLink and community patches.</p>
    <p><a href="https://discord.gg/aBUTzGnCUS" target="_blank" rel="noopener">Discord</a> â€¢ 
       <a href="https://nightly.link/Vita3K/Vita3K/actions/runs/16026361158" target="_blank" rel="noopener">Download</a></p>
  </div>

  <div class="card">
    <h3>Adrenaline (Real Hardware)</h3>
    <p>Ad-hoc and infrastructure multiplayer on modded PS Vita systems using Adrenaline PSP mode.</p>
    <p><a href="https://github.com/TheOfficialFloW/Adrenaline" target="_blank" rel="noopener">GitHub</a> â€¢ 
       <a href="https://youtu.be/4ZUxJP0sW_Y" target="_blank" rel="noopener">Setup Guide</a> â€¢ 
       <a href="https://discord.gg/aBUTzGnCUS" target="_blank" rel="noopener">Community</a></p>
  </div>

</div>
      

      <!-- PS2 -->
      <button class="collapsible" type="button">PS2 Connections</button>
      <div class="content" aria-hidden="true">
        <div class="card">
          <h3>Jak X: Combat Racing â€” PS2</h3>
          <p>Multiplayer connection method for Jak X: Combat Racing on PS2.</p>
          <p><strong>DNS:</strong> 45.7.228.197 â€¢ <a href="https://discord.com/invite/jak-x-online-multiplayer-752653132298977330" target="_blank" rel="noopener">Discord</a></p>
        </div>

        <div class="card">
          <h3>PSRewired â€” PS2</h3>
          <p>Universal online setup for PS2 games using custom DNS.</p>
          <p><strong>DNS:</strong> 67.222.156.250 â€¢ <a href="https://psrewired.com/guides/pcsx2" target="_blank" rel="noopener">Setup Guide</a></p>
        </div>

        <div class="card">
          <h3>OBSVR â€” Resident Evil Outbreak File #2</h3>
          <p>Infrastructure connection method for Resident Evil Outbreak: File #2.</p>
          <p><a href="https://obsrv.org/website" target="_blank" rel="noopener">Website</a> â€¢ <a href="https://discord.gg/88uVwczShn" target="_blank" rel="noopener">Discord</a> â€¢ <a href="https://youtu.be/Zv7o--OUQp8" target="_blank" rel="noopener">Setup Guide</a></p>
        </div>
      </div>

      <!-- PS3 -->
      <button class="collapsible" type="button">PS3 Connections</button>
      <div class="content" aria-hidden="true">
        <div class="card">
          <h3>RPCS3</h3>
          <p>PS3 emulator solution â€” community & guides.</p>
          <p><a href="https://rpcs3.net/" target="_blank" rel="noopener">Website</a> â€¢ <a href="https://discord.com/invite/RPCS3" target="_blank" rel="noopener">Discord</a> â€¢ <a href="https://www.youtube.com/watch?v=JzaocFeV4po&t=35s" target="_blank" rel="noopener">Guide</a></p>
        </div>

        <div class="card">
          <h3>PSRewired â€” PS3</h3>
          <p>Custom DNS & community tooling.</p>
          <p><strong>DNS:</strong> 67.222.156.250 â€¢ <a href="https://psrewired.com/" target="_blank" rel="noopener">Website</a></p>
        </div>

        <div class="card">
          <h3>XLink Kai â€” PS3</h3>
          <p>Network tunneling for PS3 (hardware & emulator support).</p>
          <p><a href="https://www.teamxlink.co.uk/" target="_blank" rel="noopener">Website</a> â€¢ <a href="https://discord.gg/team-xlink-official-521915206972997664" target="_blank" rel="noopener">Discord</a></p>
        </div>

        <div class="card">
          <h3>PSONE (PSX Revivals)</h3>
          <p>Community revivals & DNS for PSX games.</p>
          <p><strong>DNS:</strong> 185.194.142.4 â€¢ <a href="https://www.psone.online/getting-started#" target="_blank" rel="noopener">Guide</a></p>
        </div>
      </div>

      <!-- Arcade -->
      <button class="collapsible" type="button">Arcade Connections</button>
      <div class="content" aria-hidden="true">
        <div class="card">
          <h3>Arkadyzja</h3>
          <p>Rollback-powered connection for PSX / Dreamcast / FBNeo / MAME.</p>
          <p><a href="https://github.com/Arkadyzja/ArkadyzjaClient/releases" target="_blank" rel="noopener">GitHub</a> â€¢ <a href="https://discord.gg/qBVN2nqAHc" target="_blank" rel="noopener">Discord</a> â€¢ <a href="https://youtu.be/9_pGj-tnkJM?si=Zo0DFLljnnLgSk8z" target="_blank" rel="noopener">Video Guide</a></p>
        </div>

        <div class="card">
          <h3>Fightcade</h3>
          <p>Online arcade multiplayer for classic fighters and cabinets.</p>
          <p><a href="https://www.fightcade.com/" target="_blank" rel="noopener">Website/Download</a> â€¢ <a href="https://youtu.be/9fpeDgxGTEQ?si=6xqPugYz_t09tbnA" target="_blank" rel="noopener">Video Guide</a> â€¢ <a href="https://discord.gg/fightcade-official-160417191743848448" target="_blank" rel="noopener">Discord</a></p>
        </div>

        <div class="card">
          <h3>RetroArch Netplay</h3>
          <p>Netplay across various retro systems through RetroArch.</p>
          <p><a href="https://www.retroarch.com/?page=platforms" target="_blank" rel="noopener">Download</a> â€¢ <a href="https://youtu.be/wFE3S5TIawA?si=SzRurCi9KSoR_fbf" target="_blank" rel="noopener">Video Guide</a></p>
        </div>

        <div class="card">
          <h3>Parsec</h3>
          <p>Remote play / streaming for local multiplayer sessions; works for PC hosts.</p>
          <p><a href="https://parsec.app/" target="_blank" rel="noopener">Website</a> â€¢ <a href="https://youtu.be/ut3Uaj5MFsM?si=bNZ0ecJBZaSU4nym" target="_blank" rel="noopener">Video Guide</a></p>
        </div>
      </div>

      <!-- PC -->
      <button class="collapsible" type="button">PC Connections</button>
      <div class="content" aria-hidden="true">
        <div class="card">
          <h3>Parsec</h3>
          <p>Cloud-based remote play for local multiplayer retro games.</p>
          <p><a href="https://parsec.app/" target="_blank" rel="noopener">Website</a> â€¢ <a href="https://youtu.be/ut3Uaj5MFsM?si=bNZ0ecJBZaSU4nym" target="_blank" rel="noopener">Video Guide</a></p>
        </div>

        <div class="card">
          <h3>RetroArch Netplay</h3>
          <p>Netplay across many retro systems.</p>
          <p><a href="https://www.retroarch.com/?page=platforms" target="_blank" rel="noopener">Website</a></p>
        </div>
      </div>
      <!-- Submit -->
      <section id="submitMethodSection">
        <h2>Have a new connection method? Submit it here!</h2>
        <p>Help expand the RetroOnlineMatchmaking network by submitting your own connection methods.</p>
        <a class="button" id="openFormBtn" href="https://docs.google.com/forms/d/e/1FAIpQLScm5TrARTAVqajDcivjW5kiGGD5nYQYjI6Wph6U3E3P5-sXLg/viewform" target="_blank" rel="noopener">Submit New Method</a>
      </section>

      <footer class="site-footer">
        Â© 2025 RetroOnlineMatchmaking â€” Built by the community
      </footer>
    </div>
  </main>

  <!-- Google form modal -->
  <div id="formModal" class="modal" aria-hidden="true">
    <span class="close-btn" id="closeModal" role="button" aria-label="Close form">&times;</span>
    <div style="color:#0ff; font-weight:700; margin-bottom:10px;">Have new methods? Submit them here.</div>
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScm5TrARTAVqajDcivjW5kiGGD5nYQYjI6Wph6U3E3P5-sXLg/viewform?embedded=true" title="Submission Form">Loadingâ€¦</iframe>
  </div>

  <!-- Custom cursor -->
  <img id="customCursor" src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExaWZnOXpucnlxdXB5cDNteHJ0ZjJtOGZvOXl1cGoxbms2YTV0Njc4MSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/LrR1cXPmuyYUUMS1W5/giphy.gif" alt="" aria-hidden="true">

  <!-- Audio -->
  <audio id="bgAudio" loop preload="auto" style="display:none">
    <source src="https://cdn.jsdelivr.net/gh/retrogamemaster/retro-assets/8bit-loop.mp3" type="audio/mpeg">
  </audio>

<script>
/* ---------- Splash + progress ---------- */
window.addEventListener('load', function onLoad() {
  window.removeEventListener('load', onLoad);
  const splash = document.getElementById('splash');
  const main = document.getElementById('mainContent');
  const progressBar = document.getElementById('progressBar');
  const bootText = document.getElementById('bootText');
  const splashTitle = document.getElementById('splashTitle');
  let progress = 0;
  const messages = [
    "Checking Arcade Servers...",
    "Loading Multiplayer Modules...",
    "Initializing Retro Systems...",
    "Syncing Online Players...",
    "Bringing Up Lobbies..."
  ];
  let idx = 0;
  const interval = setInterval(() => {
    progress += Math.ceil(Math.random()*3);
    if (progress > 100) progress = 100;
    if (progressBar) progressBar.style.width = progress + '%';
    if (progress >= (idx+1)*20 && idx < messages.length) {
      if (bootText) bootText.textContent = messages[idx++];
    }
    if(progress >= 60 && splashTitle && !splashTitle.dataset.switched){
      splashTitle.dataset.switched = '1';
      splashTitle.textContent = "CHECKING CONNECTION...";
    }
    if (progress >= 100) {
      clearInterval(interval);
      if (bootText) bootText.textContent = "ONLINE!";
      setTimeout(() => {
        splash.classList.add('fade');
        setTimeout(()=> {
          try { splash.remove(); } catch(e){ splash.style.display='none'; }
          if (main) { main.style.display = 'block'; main.setAttribute('aria-hidden', 'false'); }
          initCursorAndCanvas();
          initCollapsibles();
          initFormControls();
          initMusicToggle();
        }, 480);
      }, 420);
    }
  }, 70);
});

/* ---------- Collapsibles ---------- */
function initCollapsibles(){
  const coll = document.querySelectorAll('.collapsible');
  coll.forEach(c=>{
    if(c.dataset.bound) return;
    c.dataset.bound = '1';
    c.addEventListener('click', function(){
      this.classList.toggle('active');
      const content = this.nextElementSibling;
      if(!content) return;
      if(content.style.maxHeight){
        content.style.maxHeight = null;
        content.setAttribute('aria-hidden','true');
      } else {
        content.style.maxHeight = content.scrollHeight + 'px';
        content.setAttribute('aria-hidden','false');
      }
    });
  });
}

/* ---------- Form controls ---------- */
function initFormControls(){
  const openBtn = document.getElementById('openSubmitBtn');
  const modal = document.getElementById('formModal');
  const closeModal = document.getElementById('closeModal');
  if(openBtn){
    openBtn.addEventListener('click', function(e){
      const url = "https://docs.google.com/forms/d/e/1FAIpQLScm5TrARTAVqajDcivjW5kiGGD5nYQYjI6Wph6U3E3P5-sXLg/viewform";
      window.open(url, '_blank', 'noopener');
    });
  }
  if(closeModal){
    closeModal.addEventListener('click', ()=> modal.style.display='none');
    window.addEventListener('click', (ev)=> { if(ev.target === modal) modal.style.display='none'; });
  }
}

/* ---------- Music Toggle ---------- */
function initMusicToggle(){
  const musicBtn = document.getElementById('musicButton');
  const bgAudio = document.getElementById('bgAudio');
  let musicPlaying = false;
  if(!musicBtn || !bgAudio) return;
  musicBtn.addEventListener('click', () => {
    if(!musicPlaying){
      bgAudio.play().then(()=> {
        musicPlaying = true;
        musicBtn.classList.add('muted');
        musicBtn.textContent = 'â¸ Music';
      }).catch(err=>{
        console.warn('Playback blocked', err);
        musicBtn.textContent = 'â–¶ Play Music';
      });
    } else {
      bgAudio.pause();
      musicPlaying = false;
      musicBtn.classList.remove('muted');
      musicBtn.textContent = 'ðŸ”Š Music';
    }
  });
}

/* ---------- Cursor & Canvas background ---------- */
function initCursorAndCanvas(){
  const cursor = document.getElementById('customCursor');
  if(cursor) cursor.style.display = 'block';
  document.addEventListener('mousemove', function(e){
    if(!cursor) return;
    cursor.style.left = e.clientX + 'px';
    cursor.style.top = e.clientY + 'px';
  });
  const canvas = document.getElementById('retroCanvas');
  const ctx = canvas.getContext('2d');
  function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // star & particle layers
  const starLayers = [
    {count:80, speed:0.2, sizeRange:[1,2], stars:[]},
    {count:50, speed:0.5, sizeRange:[0.7,1.4], stars:[]},
    {count:25, speed:1.1, sizeRange:[0.6,1.2], stars:[]}
  ];
  starLayers.forEach(layer=>{
    for(let i=0;i<layer.count;i++){
      layer.stars.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        size: Math.random()*(layer.sizeRange[1]-layer.sizeRange[0]) + layer.sizeRange[0],
        col: `rgba(0,255,255,${Math.random()*0.6+0.2})`
      });
    }
  });
  const particles = [];
  for(let i=0;i<40;i++){
    particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5)*0.4, vy: (Math.random()-0.5)*0.4, r: Math.random()*1.8+0.6, a: Math.random()*0.6+0.2 });
  }
  const shooting = [];
  function spawnShoot(){ shooting.push({ x: Math.random()*canvas.width, y: -20, vx: Math.random()*3+1.2, vy: Math.random()*2+1.2, len: Math.random()*80+30, a: 1 }); }
  setInterval(spawnShoot, 2600);

  const trail = []; const maxTrail=14;
  document.addEventListener('mousemove', e => { trail.push({x:e.clientX, y:e.clientY, t:Date.now()}); if(trail.length>maxTrail) trail.shift(); });

  function frame(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const g = ctx.createRadialGradient(canvas.width/2, canvas.height*0.12, 0, canvas.width/2, canvas.height/1.1, Math.max(canvas.width, canvas.height));
    g.addColorStop(0, 'rgba(0,30,60,0.05)'); g.addColorStop(1, 'rgba(0,0,0,0.6)'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);

    starLayers.forEach(layer=>{ layer.stars.forEach(s=>{ s.y += layer.speed; if(s.y>canvas.height) s.y=0; ctx.fillStyle=s.col; ctx.fillRect(s.x,s.y,s.size,s.size); }); });

    ctx.strokeStyle='rgba(0,255,255,0.06)'; ctx.lineWidth=1;
    const spacing=Math.max(60, Math.floor(canvas.width/16)); let offset=(Date.now()/50)%spacing;
    for(let x=0;x<canvas.width;x+=spacing){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
    for(let y=0;y<canvas.height;y+=spacing){ ctx.beginPath(); ctx.moveTo(0,y+offset); ctx.lineTo(canvas.width,y+offset); ctx.stroke(); }

    particles.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; if(p.x<0)p.x=canvas.width; if(p.x>canvas.width)p.x=0; if(p.y<0)p.y=canvas.height; if(p.y>canvas.height)p.y=0; ctx.beginPath(); ctx.fillStyle=`rgba(0,255,255,${p.a})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });

    for(let i=shooting.length-1;i>=0;i--){ const s=shooting[i]; s.x+=s.vx; s.y+=s.vy; s.a-=0.01; ctx.strokeStyle=`rgba(0,255,255,${s.a})`; ctx.beginPath(); ctx.moveTo(s.x,s.y); ctx.lineTo(s.x-s.len,s.y-s.len); ctx.stroke(); if(s.a<=0) shooting.splice(i,1); }

    for(let i=0;i<trail.length;i++){ const p=trail[i]; const alpha=(i+1)/trail.length*0.9; ctx.fillStyle=`rgba(0,200,255,${alpha*0.5})`; ctx.beginPath(); ctx.arc(p.x,p.y,2+(i/maxTrail)*3,0,Math.PI*2); ctx.fill(); }
  requestAnimationFrame(frame);
  }
  frame();
}

/* ---------- DOM stars fallback ---------- */
document.addEventListener('DOMContentLoaded', () => {
  const starContainer = document.querySelector('.stars');
  if(starContainer && starContainer.children.length === 0){
    for(let i=0;i<40;i++){
      const s=document.createElement('div'); s.className='star'; s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%'; s.style.opacity=(0.2+Math.random()*0.8).toString();
      starContainer.appendChild(s);
    }
  }
});

/* ---------- Keyboard focus accessibility ---------- */
(function(){
  const body=document.body;
  window.addEventListener('keydown', e=>{ if(e.key==='Tab') body.classList.add('show-focus'); });
  window.addEventListener('mousedown', ()=>{ body.classList.remove('show-focus'); });
})();
</script>
</body>
</html>
