<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROM - RetroOnlineMatchmaking</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', sans-serif;
            background: #0a0a0a;
            color: #00ffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
        }
        
        .app {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 30, 60, 0.8);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        h2 {
            color: #ff33cc;
            margin-bottom: 30px;
        }
        
        .modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .module-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .module-btn:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        }
        
        .status {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        footer {
            margin-top: 40px;
            color: #a8dfe8;
        }
        
        .loading {
            font-size: 1.5rem;
            margin: 40px 0;
            color: #ffff00;
        }
    </style>
</head>
<body>
    <div class="app">
        <h1>üéÆ ROM</h1>
        <h2>RetroOnlineMatchmaking v2.0</h2>
        
        <div class="loading" id="status">Initializing ROM Application...</div>
        
        <div class="modules" id="modules" style="display: none;">
            <button class="module-btn" onclick="loadModule('dashboard')">üè† Dashboard</button>
            <button class="module-btn" onclick="loadModule('games')">üéÆ Games</button>
            <button class="module-btn" onclick="loadModule('auth')">üîê Login</button>
            <button class="module-btn" onclick="loadModule('chat')">üí¨ Chat</button>
            <button class="module-btn" onclick="loadModule('profile')">üë§ Profile</button>
        </div>
        
        <div class="status">
            <div class="status-item">
                <div class="dot"></div>
                <span>Supabase: Connected</span>
            </div>
            <div class="status-item">
                <div class="dot" style="background: #00ffff;"></div>
                <span>Modules: Ready</span>
            </div>
            <div class="status-item">
                <div class="dot" style="background: #ff33cc;"></div>
                <span>Users Online: <span id="onlineCount">0</span></span>
            </div>
        </div>
        
        <footer>
            <p>¬© 2025 ROM - Modular Architecture</p>
            <p><a href="/legacy.html" style="color: #ff33cc;">View Legacy Version</a></p>
        </footer>
    </div>

    <script>
    // ROM Module System
    const modules = {
        dashboard: {
            name: "Dashboard",
            icon: "üè†",
            file: "dashboard.js"
        },
        games: {
            name: "Games",
            icon: "üéÆ", 
            file: "games.js"
        },
        auth: {
            name: "Auth",
            icon: "üîê",
            file: "auth.js"
        },
        chat: {
            name: "Chat",
            icon: "üí¨",
            file: "chat.js"
        },
        profile: {
            name: "Profile",
            icon: "üë§",
            file: "profile.js"
        }
    };

    let currentUser = null;

    // Initialize
    async function initROM() {
        console.log('üöÄ ROM Initializing...');
        
        // Initialize Supabase
        window.supabase = supabase.createClient(
            'https://lapyxhothazalssrbimb.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhcHl4aG90aGF6YWxzc3JiaW1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNjg0NDUsImV4cCI6MjA3Njk0NDQ0NX0.isfh75lAbJotctu6dkd_aAYK-2YNyYM4o-jqKFB5tVA'
        );
        
        // Check auth status
        try {
            const { data: { user } } = await window.supabase.auth.getUser();
            currentUser = user;
            updateUI();
        } catch (error) {
            console.log('Auth check skipped:', error);
        }
        
        // Show modules
        setTimeout(() => {
            document.getElementById('status').style.display = 'none';
            document.getElementById('modules').style.display = 'grid';
        }, 1000);
        
        console.log('‚úÖ ROM Ready');
    }

    // Update UI based on auth
    function updateUI() {
        const authBtn = document.querySelector('[onclick="loadModule(\'auth\')"]');
        if (currentUser) {
            authBtn.textContent = 'üö™ Logout';
            authBtn.onclick = () => logout();
        } else {
            authBtn.textContent = 'üîê Login';
            authBtn.onclick = () => loadModule('auth');
        }
    }

    // Load module
    async function loadModule(moduleName) {
        console.log(`üì¶ Loading: ${moduleName}`);
        
        const module = modules[moduleName];
        if (!module) {
            alert('Module not found!');
            return;
        }
        
        // Show loading
        document.getElementById('status').style.display = 'block';
        document.getElementById('status').textContent = `Loading ${module.name}...`;
        document.getElementById('modules').style.display = 'none';
        
        try {
            // Try to load the module HTML
            const response = await fetch(`/modules/${module.file}`);
            
            if (!response.ok) {
                // If file doesn't exist yet, create it
                await createModuleTemplate(moduleName);
                loadModule(moduleName); // Try again
                return;
            }
            
            const html = await response.text();
            
            // Replace entire app with module
            document.querySelector('.app').innerHTML = `
                <div class="module-header">
                    <button onclick="goHome()" style="background:none;border:1px solid #00ffff;color:#00ffff;padding:10px;border-radius:5px;cursor:pointer">
                        ‚Üê Back
                    </button>
                    <h1>${module.icon} ${module.name}</h1>
                </div>
                <div class="module-content">
                    ${html}
                </div>
            `;
            
            // Load module JS if exists
            await loadModuleJS(moduleName);
            
        } catch (error) {
            console.error('Failed to load module:', error);
            document.getElementById('status').textContent = `Error loading ${module.name}`;
            setTimeout(() => {
                document.getElementById('status').style.display = 'none';
                document.getElementById('modules').style.display = 'grid';
            }, 2000);
        }
    }

    // Create module template if doesn't exist
    async function createModuleTemplate(moduleName) {
        const templates = {
            dashboard: `<div class="dashboard">
                <h2>Welcome to ROM Dashboard</h2>
                <p>This is your central hub for all retro gaming matchmaking.</p>
                <div class="stats">
                    <div class="stat-card">Active Players: 128</div>
                    <div class="stat-card">Online Games: 24</div>
                    <div class="stat-card">Your Friends: 12</div>
                </div>
            </div>`,
            
            games: `<div class="games">
                <h2>üéÆ Game Library</h2>
                <p>Browse and join retro games with online matchmaking.</p>
                <div class="game-list">
                    <div class="game">SOCOM II <span class="players">42 online</span></div>
                    <div class="game">Twisted Metal <span class="players">28 online</span></div>
                    <div class="game">Warhawk <span class="players">36 online</span></div>
                </div>
            </div>`,
            
            auth: `<div class="auth">
                <h2>üîê Login / Register</h2>
                <div class="auth-form">
                    <input type="email" placeholder="Email" id="authEmail">
                    <input type="password" placeholder="Password" id="authPassword">
                    <button onclick="handleLogin()">Login</button>
                    <button onclick="handleRegister()">Register</button>
                </div>
            </div>`,
            
            chat: `<div class="chat">
                <h2>üí¨ Global Chat</h2>
                <div class="chat-box" id="chatBox">
                    <div class="message">System: Welcome to ROM Chat!</div>
                </div>
                <input type="text" placeholder="Type a message..." id="chatInput">
                <button onclick="sendMessage()">Send</button>
            </div>`,
            
            profile: `<div class="profile">
                <h2>üë§ Your Profile</h2>
                <div class="profile-info">
                    <p>Username: ${currentUser ? currentUser.email : 'Guest'}</p>
                    <p>Status: ${currentUser ? 'Online' : 'Offline'}</p>
                </div>
            </div>`
        };
        
        // Save the template
        // In a real app, this would save to a file
        console.log(`Created template for ${moduleName}`);
    }

    // Load module JavaScript
    async function loadModuleJS(moduleName) {
        try {
            const script = document.createElement('script');
            script.type = 'module';
            script.src = `/modules/${moduleName}.js`;
            document.head.appendChild(script);
        } catch (error) {
            console.log(`No JS for ${moduleName}`);
        }
    }

    // Auth functions
    async function handleLogin() {
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        
        try {
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });
            
            if (error) throw error;
            
            currentUser = data.user;
            alert('Login successful!');
            goHome();
            
        } catch (error) {
            alert('Login failed: ' + error.message);
        }
    }

    async function handleRegister() {
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        
        try {
            const { data, error } = await supabase.auth.signUp({
                email,
                password
            });
            
            if (error) throw error;
            
            alert('Registration successful! Check your email.');
            goHome();
            
        } catch (error) {
            alert('Registration failed: ' + error.message);
        }
    }

    async function logout() {
        await supabase.auth.signOut();
        currentUser = null;
        alert('Logged out!');
        goHome();
    }

    // Chat functions
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const chatBox = document.getElementById('chatBox');
        
        if (input.value.trim()) {
            const msg = document.createElement('div');
            msg.className = 'message';
            msg.textContent = `${currentUser ? currentUser.email : 'Guest'}: ${input.value}`;
            chatBox.appendChild(msg);
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }

    // Navigation
    function goHome() {
        location.reload(); // Simple way to go back to home
    }

    // Start ROM
    document.addEventListener('DOMContentLoaded', initROM);
</script>
